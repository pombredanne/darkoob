{% extends "base/profile_base.html" %}

{% load staticfiles %}
{% load endless %}

{% block css %}
{{ block.super }}
<link rel="stylesheet" type="text/less" href="{% static "/static/css/home_style.less" %}">
<link rel="stylesheet" type="text/less" href="{% static "/static/css/posts_style.less" %}">
{% endblock css %}

{% block js %}

<script>


function set_my_quote_callback(data){
  if (data.done){
    $.pnotify({
      title: 'Profile Updated',
      text: data.message,
      opacity: .8
    })
  }else{
    for (i in data.errors){
      $.pnotify({
        title: 'Error',
        type:'error',
        text: data.errors[i],
        opacity: .8
      })
    }
  }
}
function submit_private_key_callback(data){
  if (data.done){
    $.pnotify({
      type: 'success',
      title: 'correct info',
      text: data.message,
      opacity: .8
    })
  }else{
    for (i in data.errors){
      $.pnotify({
        title: 'Error',
        type:'error',
        text: data.errors[i],
        opacity: .8
      })
    }
  }
}
</script>


{{ block.super }}
{% endblock js %}


{% block sidebar %}
<div class="row-fluid">
  <div class="span12">
    <script type="text/javascript">
      //TODO: It's very dirty code
      function close_1(){
        $('#follow_suggestion_1').remove();
      }
      function close_2(){
        $('#follow_suggestion_2').remove();
      }
      function close_3(){
        $('#follow_suggestion_3').remove();
      }
      function follow_request_callback_1(data){
        alert(data.done);
        close_1();
      }
      function follow_request_callback_2(data){
        alert(data.done);
        close_2();
      }
      function follow_request_callback_3(data){
        alert(data.done);
        close_3();
      }
    </script>

    <div class="row-fluid">
      <div class="span10 sidebox">
        <legend>Suggest To Follow</legend>  
        # TODO : ISSUE #54
        <p id='person_box'>
          <div id='follow_suggestion_1'>
            <button class="close" id="close_button_1" onmousedown="close_1()">&times;</button>
            {{ suggestion_list.0 }} <a onmousedown="Dajaxice.darkoob.social.follow_request(follow_request_callback_1,{'following_id': {{suggestion_list.0.id }}})">Follow</a>
          </div>
          <div id='follow_suggestion_2' id="close_button_2" onmousedown="close_2()">
            <button class="close">&times;</button>
            {{ suggestion_list.1 }} <a onmousedown="Dajaxice.darkoob.social.follow_request(follow_request_callback_2,{'following_id': {{suggestion_list.1.id }}})">Follow</a>
          </div>
          <div id='follow_suggestion_3' id="close_button_3" onmousedown="close_3()">
            <button class="close">&times;</button>
            {{ suggestion_list.2 }} <a onmousedown="Dajaxice.darkoob.social.follow_request(follow_request_callback_3,{'following_id': {{suggestion_list.2.id }}})">Follow</a>
          </div>
        </p>
      </div> <!-- span10 -->
    </div> <!-- row -->



    <div class="row-fluid">
      <div class="span10 sidebox">
        <legend>Hoping</legend>
        <p>
          <br />
          <script type="text/javascript">
            $(document).ready(function() {
              $("#vahid").typeahead({
                source: function (query, process) {
                  return $.get('/book/look', {  query: query }, function (data) {
                    return process(data.options);
                  });
                }   
              });
            });
          </script>
          <input type="text" id="vahid" data-provide='typeahead'>
          <br />
          I Get a book( TODO: tooltip(private key is 10 digit key that writen in your book) )
          </br>
          <input type="text" placeholder="Private Key" id='private_key'> 
          <button id='' class="btn btn-inverse" onmousedown="Dajaxice.darkoob.migration.submit_key(submit_private_key_callback,{'private_key': $('#private_key').val() })">Check</button>
        </p>
        Find f
      </div> <!-- span10 -->
    </div> <!-- row -->
    <div class="row-fluid">
      <div class="span10 sidebox">
        <legend>Groups</legend>
        <p>
          <ul>
            {% for group in admin_groups %}
              <li><a href="{% url 'group:group_page' group_id=group.id group_name=group.name %}">{{ group.name }}</a></li>
            {% endfor %}

            {% for group in groups %}
              <li><a href="{% url 'group:group_page' group_id=group.id group_name=group.name %}">{{ group.name }}</a></li>
            {% endfor %}
          </ul>
        </p>
      </div> <!-- span10 -->
    </div> <!-- row -->
    <div class="row-fluid">
      <div class="span10 sidebox">
        <legend>Deadlines</legend>
        <ul>
          {% for book in book_deadlines %}
            <li class="deadline"><a href="#">{{ book.0 }}</a>
              <span style="display: none;">
                {% for deadline in book.1 %}
                  <div class="progress 
                    {% if deadline.time_percentage > 90 %} progress-danger
                    {% else %}{% if deadline.time_percentage > 60 %} progress-warning 
                    {% else %} progress-success
                    {% endif %} {% endif %}"
                  style="width: 88%;">
                    <div class="bar" style="width: {{ deadline.time_percentage }}%;"></div>
                  </div>
                {% endfor %}
              </span>
          {% endfor %}
          </li>
        </ul>
      </div> <!-- span10 -->
    </div> <!-- row -->
  </div> <!-- span12 -->
</div> <!-- row -->
{% endblock sidebar %}
{% block main %}
<div class="row-fluid">
  <div class="span12">
    <div class="row-fluid">

      <div class="span12">

        <div class="quote">

          <blockquote>
            <p>{{ quote.text }}</p><!-- Those who mind don't matter, and those who matter don't mind. -->
            {% if quote.author %}<small>{{ quote.author }}</small>{% endif %}<!-- Bernard M. Baruch -->
            {% if quote.book %}<small>{{ quote.book }}</small>{% endif %}

            <a href="#"
              onclick="javascript:Dajaxice.darkoob.social.set_my_quote(
              set_my_quote_callback, {'quote_id': {{ quote.id }} })">
              <i data-toggle="tooltip"id="set_quote" class="icon-ok pull-right">
              </i>
            </a>
          </blockquote>
        </div>
      </div>
    </div> <!-- row -->
    <div class="row-fluid suggestion">
      <div class="span12">
        <p>
          I suggest you to read something.
          <span>
            <button class="close pull-right" onClick="remove_suggestion()">&times;</button>
          </span>
        </p>
      </div>
    </div> <!-- row -->
    <div class="row-fluid">
      <div class="span12">
        <div class="sidebox">
          <div class="row-fluid">
            <div class="span7 new_post_container">
              <form method="post" action="{% url "social:new_post" %}">
                {% csrf_token %}
                {{ new_post_form.text }}
              </form>
            </div>
            <script type="text/javascript">
              function submit_post_callback(data){
                var str = $('#id_text').val()
                $("#new_post_position").append("<div>"+ str +"</div>")
                $('#id_text').val('')

              }
            </script>
            <div class="span1 new_post_button">
              <a onmousedown="Dajaxice.darkoob.social.submit_post(submit_post_callback,{'text': $('#id_text').val()})"> Post </a>
              <button class="btn btn-inverse">Post</button>
            </div>
          </div> <!-- row -->
        </div> <!-- sidebox -->
      </div> <!-- span12 -->
    </div> <!-- row -->

    <div id="new_post_position">
    </div>
    {% include 'post/posts.html' %}
  </div> <!-- span8 -->
</div> <!-- row -->
{% endblock main %}

{% block bottom_js %}
{{ block.super }}
<script>
  $("#set_quote").tooltip({
    title: "Set as favorite",
    placement: "right",
  });
</script>
<script type="text/javascript" src="{% static "/static/js/home.js" %}"></script>
<script>
  function remove_suggestion() {
    $('.suggestion').remove();
  }
</script>
{% endblock bottom_js %}
