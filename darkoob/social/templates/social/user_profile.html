{% extends "base/profile_base.html" %}
{% load staticfiles %}
{% load thumbnail %}
{% block css %}
{{ block.super }}
<link rel="stylesheet" type="text/less" href="{% static "/static/css/profile_base_style.less" %}">
<link rel="stylesheet" type="text/less" href="{% static "/static/css/home_style.less" %}">
{% endblock css %}
{% block title %}User{% endblock title %}

{% load avatar_tags %}

{% block sidebar %}
<div class="row-fluid">
  <div class="span12">
    <div class="row-fluid">
      <div class="span10 sidebox">
        <legend>Profile Information</legend>
          <p>
            <a href='{% url "avatar_change" %}'>Change your avatar</a>

            {% avatar user %}

            list<br />
            of<br />
            groups
            <h3>
            {{ user}}
            </h3>
            <b> TODO </b>
            <br />
            Followers Link
            Followers Link<br />
            Following Link<br />
            Favorite Book Link<br />
          </p>
      </div> <!-- span10 -->
    </div> <!-- row -->
    <div class="row-fluid">
      <div class="span10 sidebox">
        <legend>Groups</legend>
        <p>
          list<br />
          of<br />
          groups
        </p>
      </div> <!-- span10 -->
    </div> <!-- row -->
    <div class="row-fluid">
      <div class="span10 sidebox">
        <legend>Books</legend>
        <p>
          TODO: links
          {% for book in favorite_book %}
          {#{% url 'book:book_page' book_id=book.id book_name=book.title %}#}
            <li><a href="TODO">{{ book.title }}</a></li>
          {% endfor %}
          salam
        </p>
      </div> <!-- span10 -->
    </div> <!-- row -->
  </div> <!-- span12 -->
</div> <!-- row -->
{% endblock sidebar %}

{% block main %}
<div class="row-fluid">
  <div class="span12">

    <div class="row-fluid">
      <div class="span12 sidebox">
        <legend>Migrations</legend>


          <p>
            {% for migration in migrations %}
                {% thumbnail migration.book.thumb "50x50" crop="center" as im %}
                  <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
                {% endthumbnail %}
              <b>{{ migration.book.title }} <--> </b> 
              {% if migration.starter == request.user %}
                {{ migration.starter }}
                {% avatar migration.starter 30%}
              {% else %}
                <a href="{% url 'social:user_profile' username=migration.starter.username %}">{{ migration.starter }}</a>
                {% avatar migration.starter 30%}
              {% endif %}
              {# slice can be change with "1:3"#}
              {% for hop in migration.hop_set.all|slice:":"|dictsort:"received_time" %}
                >>>
                {% if hop == request.user %}
                  {% avatar request.user 30%}
                  MAN
                {% else %}
                  <a href="{% url 'social:user_profile' username=hop.host.username %}">{{ hop.host }}</a>
                  {% avatar hop.host 30 %}

                {% endif %}
              {% endfor %}
              <br />
            {% endfor %}
          </p>
      </div> <!-- span10 -->
    </div> <!-- row -->

    <div class="row-fluid">
      <div class="span12">
        <div class="quote">
          <blockquote>
            <p>{{ user.userprofile.quote.text }}</p>
            {% if user.userprofile.quote.author %}<small>{{ user.userprofile.quote.author }}</small>{% endif %}
            {% if user.userprofile.quote.book %}<small>{{ user.userprofile.quote.book }}</small>{% endif %}
          </blockquote>
        </div>
        {% block right_sidebox %}
          <div class="sidebox post">
            <p>
              This is user's first post.
            </p>
          </div>
        {% endblock right_sidebox %}


      </div> <!-- span12 -->
    </div> <!-- row -->



  </div> <!-- span12 -->
</div> <!-- row -->
{% endblock main %}
